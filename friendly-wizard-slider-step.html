<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../../bower_components/polymer/lib/utils/async.html">
<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">

<link rel="import" href="friendly-wizard-step.html">

<dom-module id="friendly-wizard-slider-step">
  <template>
    <style>
      #container {
        @apply --friendly-step-container;
      }

      #header-container {
        @apply --friendly-step-header;
      }

      #footer-container {
        @apply --friendly-step-footer;
      }

      #content-container {
        @apply --friendly-step-content;
      }

      #slider-container{
        box-sizing: border-box;
        padding: 2rem;
      }
      paper-slider{
        
        width: 100%;
      }
    </style>

    <div id="container">
      <div id="header-container">
        <slot name="header" id="header"></slot>
      </div>

      <div id="content-container">
        <div id="slider-container">
          <paper-slider pin snaps value="{{selected}}" immediate-value="{{selected}}" min="0" max="9" step="1"></paper-slider>
          <p>[[_foo(selected, options)]]</p>
        </div>
      </div>

      <div id="footer-container">
        <slot name="footer" id="footer"></slot>
      </div>
    </div>
    

  </template>

  <script>
    class FriendlyWizardSliderStep extends FriendlyWizardStep {
      static get is() { return 'friendly-wizard-slider-step'; }

      static get properties (){
        return Object.assign(super.properties, {
          selected:{
            notify:true,
            type: Number,
            value: 5
          },

          selectedValues:{
            notify:true,
            type: Array,
            value: () => {return []}
          },

          minSelected:{
            type: Number,
            value: 0
          },

          maxSelected:{
            type: Number,
            value: 0
          },

          fallbackSelection:{
            type: String,
            value: ''
          },

          attrForSelected:{
            type: String,
            value: ''
          },

          multi:{
            type: Boolean,
            value: false
          },

          interactiveNodes:{
            type: Array,
            value: () => {return []}
          }
        });
      }

      _foo(selected, options){
        if(!options){return}
        return options[selected]
      }

      /**
      * Overrides super method
      */
      _getSlots(){
        return this.shadowRoot.querySelectorAll('slot#header, slot#footer');
      }

      /**
      * Handle an item selected
      * If multi is false, go to the next step
      * If multi is true, check to see if the multi conditions are met, and enable the next button
      */
      _activated(e){
        
        Polymer.Async.microTask.run(() => {
          this._validate();
          if(!this.multi){
            let item = this.$.selector.selectedItem
            if(item.hasAttribute('goto')){
              this.set('next', item.getAttribute('goto'))
            }
            // this._next()
          }
        })
      }

      _selected(e){
        console.log('selected')
        this._validate();
      }

      _deselected(e){
        this._validate();
      }

      /**
      * Checks validity of step
      * Overrides super
      * Returns true if the min number of items are selected
      * TODO: accommodate max items
      */
      validate(){
        
        return true;
        
      }

    }

    window.customElements.define(FriendlyWizardSliderStep.is, FriendlyWizardSliderStep);
  </script>
</dom-module>
